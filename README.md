
# 夢の宅配便

### 【プロジェクトの目的】

   > PHP・Laravelの習作として、ECサイトを模したジョークアプリを作成する。

### 【ECサイトの内容】

   >ECサイトで販売するものは、”夢”とする。
   >"夢の中”で物語の登場人物になったり、色々な体験ができるコースとして販売する。
   >そして販売したコースを指定時間帯に”配達”する。
   >そのような”ジョークアプリ”の構築を目指す。

### 【機能について】

  >実装済みの機能は、以下の３つです。その他は後日追加予定。
  >1.  会員登録機能        …  入会を希望する方へ会員登録機能を提供する。
  >1.  商品登録機能        …  サイトの運営側が、販売する商品を登録する。
  >1.  会員の商品購入機能   …  会員が実際の販売サイトで商品を購入する。

### 【現在までの進捗状況】

   >*  当プロジェクトは2019年10月15日から開始。
   >*  システムの企画立案から設計を12月中旬まで実施。
   >*  実装を試みる機能が多いため、1月までに制作可能な範囲をフェーズ１とし、
       最も基本的な動作部分のみ構築し、それ以外はフェーズ２以降として作業開始。
   >*  2020年2月1日でフェーズ１の開発を完了。
   >*  2020年4月10日でフェーズ２の開発を完了。
   >*  2020年4月24日でフェーズ３の開発を完了。
   >*  2020年4月24日でフェーズ４の開発を完了。
   >*  **2020年12月06日でフェーズ５の開発を完了。**

### 【フェーズ５の改修内容】
   >  フェーズ５では、煩雑になっていたcssの改善を行う。
   >  メンバー向けとオペレーター向けで大きく２つのcssがあるが、フェーズ５ではメンバー側のみの改善とする。
   >  設計書の改修は都度行うと時間がかかるため当フェーズでは見送りとする。
   > 1. Sassを導入する。記法はscssを採用する。
   > 1. 設計思想には、FLOCSSを採用する。
   >    1. 命名規則 → Modifierについては一部カスタマイズして利用する。
   >      正規の記法例）  ＜button class="c-button c-button--blue"＞
   >      カスタマイズ例）＜button class="c-button--blue"＞
   >      正規の記法では、標準となるc-buttonクラスに対して、改修したc-button--blueクラスを追記することになっているが、html側へ記述するクラスが増えてしまう。よりシンプルなコーディングとなるよう上記の例のように、改修したクラスのみで動作するようにする。
   >      ※デメリットとして、生成されるcss量が増えることになるが、当プロジェクトではコーディングの簡易性を優先することとする。
   > 1. 上記1.2.の導入に伴い、デザインの見直しを行う。
   >    1. 夢を売り物にしているので、夜の雰囲気感じられるように背景は暗めにする。
   >    1. 店に来店してきた際、建物内の明かりが漏れている雰囲気を出すため、枠線や文字にはオレンジ色をベースにする。
   > 1. フェーズ４でダブルクォーテーション(")をシングルクォーテーション(')へ置き換えた結果、一箇所バグが発生したため修正する。

### 【フェーズ４の改修内容】
   >   フェーズ４：不必要に使用されていたダブルクォーテーション(")をシングルクォーテーション(')へ統一。

### 【フェーズ３の改修内容】
   >   フェーズ３では、フェーズ１・２で作成したテストの全面リプレースとそれに付随する修正を行った。
   > 1. UNIT,Featureテストの全面リプレース
   >    1. UNIT:モデルのメソッドについては、UNITテスト側で行う。
   >    1. フォームリクエストのテストが、バリデートのインスタンスを作成して実行するやり方と、HTTPテストで実行するやり方が混在していた。
   全てHTTPテストで実行するよう統一を行った。
   >    1. 可能な限り、データプロバイダーを利用してテストするよう変更
   >    1. バリデートエラーのメッセージの確認方法がわかったため、エラー時のメッセージ確認を追加。
   >    1. テストの結果見つかったバグの修正。
   >    1. テストDBのクリアを、マイグレーション(use DataBaseMigrations)からリフレッシュ(use RefreshDatabase)へ修正。
           ※処理速度の大幅な向上
   >    1. 一括テスト実施時にエラーとならないよう、各テーブルのidを使った確認を、別の項目で確認するよう修正。
   > 1. その他
   >    1. 実行日時を意識したテストを行えるようにするため、タイムスタンプ（time()）の使用を、カーボン（Carbon::now()->timestamp）へ変更。
   >    1. 商品情報マスタ(product_masters)の存在チェックを行うフォームリクエストが重複しているため、統合を行った。
            廃止(ProductCartAddRequest.php、ProductShowRequest.php)、統合(ProductMasterIdCheckRequest.php)
   >    1. 商品カートリスト(product_cart_lists)の存在チェックを行うフォームリクエストが重複しているため、統合を行った。
            廃止(ProductCartSelectRequest.php、ProductCartDeleteRequest.php)、統合(CartListIdCheckRequest.php)
   >    1. 会員登録機能において、生年月日の和暦入力時に不具合があったため、チェック機能を見直し。
            ※和暦の生年月日で数値以外入力すると、ミドルウェアでエラーが発生した。原因はバリデーションの前に西暦へ変換するロジックが動いたため。
   >       1. ミドルウェアの西暦への計算論理を廃止。
   >       1. フォームリクエストでは生年月日の単項目チェックのみ行うよう修正。
   >       1. フォームリクエストで正常の場合、コントローラー側で生年月日の実日付チェックや、和暦の有効範囲チェック等を行うよう修正。
   >    1. 会員登録機能において、入力→確認→結果の遷移を、get→get→postで行っていたが、get→post→postで遷移するよう改善。

### 【フェーズ２の改修内容】
   >   フェーズ２では、既存の実装機能の改修を行った。
   > 1. 各機能共通の改修
   >    1. バグ修正、不要論理削除
   >    1. フェーズ１の途中で、商品在庫数を商品情報マスタから商品在庫リストへ移植にしたが、残されていた不要論理の修正・削除。
   >    1. 商品在庫リストの商品コード(product_code)にユニーク制約が漏れていたため追加
   > 1. オペレーター向け機能の改修
   >    1. 商品情報マスタ(product_masters)の仮更新者コード、仮更新承認者コードをKeyとし、オペレーター情報マスタ(operators)から名前を取得して表示するよう修正
   >    1. 商品画像、商品サムネイルのクライアント側用のパスへ変換する論理を、モデル(ProductMaster.php)へ集約
   > 1. 会員向け機能の改修
   >    1. メニューバー（会員向け画面にあった、HOME、ギャンブル、異世界転生等のボタン）をサイドバーとするよう改修。
   >    1. サイドバーにタグマスタより、タグLV1（”ギャンブル”等のカテゴリーを表すタグ）を列挙するよう改修。
   >    1. ヘッダー部（ログイン、ログアウト等のボタンを配置したバー）のレイアウト見直し
   >    1. 商品画像、商品サムネイルのクライアント側用のパスへ変換する論理を、モデル(ProductMaster.php)へ集約
   >    1. 販売状況の表示論理が多数散見サれたため、モデル(ProductMaster.php)へ集約するよう改修。
